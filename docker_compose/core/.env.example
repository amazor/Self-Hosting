# Core VM â€” env template (copy to .env and fill)
#   cp .env.example .env
# Stack reference: docker_compose/core/compose.yml

# --- Base paths / locale ---
# Root for all state/config used by this core stack. Relative paths are resolved
# from the directory where you run docker compose (e.g. docker_compose/core or ~/core).
# Run bootstrap from that same directory so Caddyfile and dnsmasq.conf are created there.
CONFIG_ROOT=./config
TZ=Etc/UTC

# --- Image tags (pin after validation for reproducibility) ---
# Caddy major tag keeps updates safe-ish while staying current.
CADDY_TAG=2
# Authentik tag should be pinned to a tested release in your environment.
AUTHENTIK_TAG=latest
POSTGRES_TAG=16-alpine
REDIS_TAG=7-alpine
DNSMASQ_TAG=latest
WHOAMI_TAG=latest

# --- Authentik + Postgres ---
# Generate AUTHENTIK_SECRET_KEY with:
#   openssl rand -base64 60
AUTHENTIK_SECRET_KEY=CHANGE_ME_LONG_RANDOM_VALUE

AUTHENTIK_POSTGRES_DB=authentik
AUTHENTIK_POSTGRES_USER=authentik
AUTHENTIK_POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# Optional first-run bootstrap: creates default akadmin user with no UI step.
# Set email + password (and optionally token) before first 'docker compose up';
# Authentik reads these on the worker on first startup only.
#   AUTHENTIK_BOOTSTRAP_TOKEN = API token for akadmin (use for automation/API auth).
# Leave empty to use the initial-setup flow in the UI after first start.
AUTHENTIK_BOOTSTRAP_EMAIL=
AUTHENTIK_BOOTSTRAP_PASSWORD=
AUTHENTIK_BOOTSTRAP_TOKEN=

# Optional. Authentik container runs as UID 1000; set if your host uses a different run-as user.
# AUTHENTIK_UID=1000
# AUTHENTIK_GID=1000

# Optional telemetry/update behavior.
AUTHENTIK_ERROR_REPORTING_ENABLED=false
AUTHENTIK_DISABLE_UPDATE_CHECK=false

# --- DNS / dnsmasq ---
# Bind address for DNS on the VM host. Use VM LAN IP to avoid listening on all interfaces.
# Example: DNS_BIND_IP=192.168.1.110
DNS_BIND_IP=0.0.0.0

# Values used by bootstrap-generated starter dnsmasq.conf (if missing).
DNS_UPSTREAM_1=1.1.1.1
DNS_UPSTREAM_2=1.0.0.1
DNS_LOCAL_DOMAIN=lab.arpa

# Optional A records bootstrap can pre-seed in dnsmasq.conf.
# Comma-separated host:ip pairs (example below):
# DNS_LOCAL_RECORDS=core:192.168.1.110,apps:192.168.1.120,media:192.168.1.130
DNS_LOCAL_RECORDS=

# --- Caddy starter template ---
# Bootstrap uses these for an initial Caddyfile if none exists.
PUBLIC_BASE_DOMAIN=example.com
AUTHENTIK_FQDN=auth.example.com
WHOAMI_FQDN=whoami.example.com
# Optional: restrict whoami to these CIDRs (others get 403). Unset = allow all (for external uptime checkers).
# Suggested value (private + Tailscale):
# WHOAMI_ALLOW_CIDRS=127.0.0.0/8 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 100.64.0.0/10

# Use Caddy's internal CA (no Let's Encrypt). Set to true for local/testing (e.g. .home.arpa, .local).
# CADDY_USE_INTERNAL_TLS=true

# --- Authentik forward auth (for SSO-protected services) ---
# URI from your Authentik Proxy Provider (Forward auth mode). Default matches Caddy auth endpoint.
# AUTHENTIK_FORWARD_AUTH_URI=/outpost.goauthentik.io/auth/caddy
# Backend for forward_auth (default: authentik-server in core stack).
# AUTHENTIK_FORWARD_AUTH_BACKEND=http://authentik-server:9000

# --- Extra services (optional) ---
# Comma-separated. Format: FQDN:host:port[:sso] or FQDN/path:host:port[:sso]
#   :sso = behind Authentik. Path = only that path (e.g. /api = no SSO for API, use with default :sso for UI).
# Examples:
#   sonarr.example.com:192.168.1.130:8989:sso
#   sonarr.example.com/api:192.168.1.130:8989
#   sonarr-api.example.com:192.168.1.130:8989
# CADDY_EXTRA_SERVICES=
